(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{242:function(e,t,a){e.exports=a(629)},345:function(e,t){},346:function(e,t){},627:function(e,t,a){},629:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"setCountries",function(){return Y}),a.d(n,"setIndicators",function(){return q}),a.d(n,"setLocation",function(){return J}),a.d(n,"setCountryValue",function(){return H}),a.d(n,"setIndicatorValue",function(){return Q}),a.d(n,"setWidgetData",function(){return X}),a.d(n,"setWidgetStats",function(){return K}),a.d(n,"setWidth",function(){return Z}),a.d(n,"default",function(){return $});var r={};a.r(r),a.d(r,"setMap",function(){return ne}),a.d(r,"setMapBounds",function(){return re}),a.d(r,"setMapStyle",function(){return ce}),a.d(r,"setMapLabels",function(){return oe}),a.d(r,"setMapRoads",function(){return ie}),a.d(r,"setBasemap",function(){return se}),a.d(r,"setMapViewport",function(){return ue}),a.d(r,"setMapLoaded",function(){return le}),a.d(r,"setMapFlying",function(){return de}),a.d(r,"getCountryBounds",function(){return pe}),a.d(r,"default",function(){return me});var c={};a.r(c),a.d(c,"setCountriesData",function(){return Le}),a.d(c,"loadDashboardData",function(){return Ie}),a.d(c,"getIndicators",function(){return Re}),a.d(c,"getCountriesData",function(){return Te}),a.d(c,"getProvincesData",function(){return _e}),a.d(c,"default",function(){return xe});var o={};a.r(o),a.d(o,"setDashboardCollapsed",function(){return Pe}),a.d(o,"setModalState",function(){return Be}),a.d(o,"setCountry",function(){return We}),a.d(o,"setIndicator",function(){return Fe}),a.d(o,"setUrl",function(){return Ue}),a.d(o,"saveData",function(){return Ge});var i={};a.r(i),a.d(i,"default",function(){return ze});var s={};a.r(s),a.d(s,"actions",function(){return o}),a.d(s,"initialState",function(){return Ve}),a.d(s,"reducers",function(){return i});var u={};a.r(u),a.d(u,"default",function(){return Ye});var l={};a.r(l),a.d(l,"actions",function(){return c}),a.d(l,"initialState",function(){return qe}),a.d(l,"reducers",function(){return u});var d={};a.r(d),a.d(d,"pageActions",function(){return Qe}),a.d(d,"setPage",function(){return Xe});var p={};a.r(p),a.d(p,"default",function(){return Ke});var m={};a.r(m),a.d(m,"actions",function(){return d}),a.d(m,"initialState",function(){return Ze}),a.d(m,"reducers",function(){return p});var f={};a.r(f),a.d(f,"default",function(){return $e});var b={};a.r(b),a.d(b,"actions",function(){return r}),a.d(b,"initialState",function(){return et}),a.d(b,"reducers",function(){return f});var h={};a.r(h),a.d(h,"setList",function(){return tt}),a.d(h,"setLoading",function(){return at}),a.d(h,"setError",function(){return nt}),a.d(h,"setLayersOpacity",function(){return rt}),a.d(h,"getLayers",function(){return ct}),a.d(h,"default",function(){return ot});var g={};a.r(g),a.d(g,"default",function(){return it});var v={};a.r(v),a.d(v,"actions",function(){return h}),a.d(v,"initialState",function(){return st}),a.d(v,"reducers",function(){return g});var O={};a.r(O),a.d(O,"default",function(){return ut});var y={};a.r(y),a.d(y,"actions",function(){return n}),a.d(y,"initialState",function(){return lt}),a.d(y,"reducers",function(){return O});var j=a(1),E=a.n(j),w=a(62),A=a.n(w),k=a(19),D=a(17);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var N=a(4),C=a(3),S=a(64),M=a(233),L=a(234),I=a(6),R=a(241),T=a(34),_=a(35),x=a(235),P=a.n(x),B=new(function(){function e(){Object(T.a)(this,e)}return Object(_.a)(e,[{key:"saveAsJSON",value:function(e){var t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e));this.triggerDownload("dataset.json",t)}},{key:"saveAsCSV",value:function(e){var t=e.map(function(e){var t=e.indicators,a=Object(R.a)(e,["indicators"]);return t?Object(C.a)({},a,Object.fromEntries(Object.entries(e.indicators).flatMap(function(e){return Object.entries(e[1]).map(function(t){return["".concat(e[0],"_").concat(t[0]),t[1]]})}))):Object(C.a)({},a)}),a=Object.keys(t[0]),n=P.a.parse(t,{fields:a}),r="data:text/csv;charset=utf-8,"+encodeURIComponent(n);this.triggerDownload("dataset.csv",r)}},{key:"saveRankings",value:function(){var e="".concat(".","/Aqueduct30_Rankings_V01.xlsx");this.triggerDownload("Aqueduct30_Rankings_V01.xlsx",e)}},{key:"triggerDownload",value:function(e,t){var a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download",e),a.click()}}]),e}()),W=[{label:"Baseline Water Stress",value:"bws"},{label:"Drought Risk",value:"drr"},{label:"Riverine Flood Risk",value:"rfr"}],F={Tot:"Total",Dom:"Domestic",Ind:"Industrial",Irr:"Agricultural",Liv:"Livestock",Pop:"Population",Avg:"Average"},U={MISSING_REQUIRED_PARAMETER:"Required parameter is not present.",MISSING_WIDGET_REQUEST_PARAMETERS:"Cannot make widget data request. Missing parameters."};function G(e){return e.filter(function(e){return"Tot"!==e.category}).reduce(function(e,t,a,n){var r=n.length;return a===r-1?(e+t.score)/r:e+t.score},0)}function z(e){return e.reduce(function(t,a){var n,r;return Object(C.a)({},t,(n={},Object(N.a)(n,a.category,{name:F[a.category],score:(r=a.score,r?r.toFixed(2):"NO DATA"),rank:a.rank}),Object(N.a)(n,"Avg",{name:F.Avg,score:G(e).toFixed(2)}),n))},{})}var V=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"country";return{iso:e,name:t[0][a],indicators:z(t)}},Y=Object(I.createAction)("DASHBOARD/setCountries"),q=Object(I.createAction)("DASHBOARD/setIndicators"),J=Object(I.createAction)("DASHBOARD/setLocation"),H=Object(I.createAction)("DASHBOARD/setCountryValue"),Q=Object(I.createAction)("DASHBOARD/setIndicatorValue"),X=Object(I.createAction)("DASHBOARD/setWidgetData"),K=Object(I.createAction)("DASHBOARD/setWidgetStats"),Z=Object(I.createAction)("DASHBOARD/setWidth"),$={setLocation:J,setCountryValue:H,setIndicatorValue:Q},ee={GENERAL:"GENERAL",COUNTRY:"COUNTRY"},te=a(41),ae=a.n(te),ne=Object(I.createAction)("MAP/setMap"),re=Object(I.createAction)("MAP/setMapBounds"),ce=Object(I.createAction)("MAP/setMapStyle"),oe=Object(I.createAction)("MAP/setMapLabels"),ie=Object(I.createAction)("MAP/setMapRoads"),se=Object(I.createAction)("MAP/setBasemap"),ue=Object(I.createAction)("MAP/setMapViewport"),le=Object(I.createAction)("MAP/setMapLoaded"),de=Object(I.createAction)("MAP/setMapFlying"),pe=Object(I.createThunkAction)("MAP/getCountryBounds",function(){return function(e,t){var a=t().dashboard,n=a.locationId,r=a.width,c="SELECT ST_AsGeoJSON(ST_AsText(ST_Envelope(the_geom))) as geometry, gid_0, name_0 FROM gadm_wri_0 WHERE gid_0 = '".concat(n,"'");ae.a.get("https://wri-rw.carto.com/api/v2/sql?q=".concat(c)).then(function(t){var a=JSON.parse(t.data.rows[0].geometry),n=window.L.geoJSON(a).getBounds().toBBoxString().split(",").map(function(e){return parseFloat(e)});e(re({bbox:n,options:{paddingTopLeft:[r,0]}}))})}}),me={setMap:ne,setMapBounds:re,setMapStyle:ce,setBasemap:se,setMapLabels:oe,setMapRoads:ie,setMapViewport:ue,setMapLoaded:le,setMapFlying:de,getCountryBounds:pe},fe=a(24),be=a.n(fe),he=a(157),ge=a(65),ve=a(45),Oe=a(73),ye=a.n(Oe),je=function(e){var t=e.id,a=e.type,n=e.attributes;return Object.assign({},{id:t,type:a},n)},Ee=function(e){var t=e.id,a=e.type,n=e.attributes,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=Object.assign({},{id:t,type:a},n);return Object.prototype.hasOwnProperty.call(c,"widget")&&(c.widget=c.widget.map(je)),Object.prototype.hasOwnProperty.call(c,"layer")&&(c.layer=c.layer.map(je)),Object.prototype.hasOwnProperty.call(c,"metadata")&&(c.metadata=c.metadata.map(je),r.locale&&(c.metadata=c.metadata.find(function(e){return e.language===r.locale})||{})),Object.prototype.hasOwnProperty.call(c,"vocabulary")&&(c.vocabulary=c.vocabulary.map(je)),Object.prototype.hasOwnProperty.call(c,"legendConfig")&&Object.prototype.hasOwnProperty.call(c.legendConfig,"items")&&(c.legendConfig.items=c.legendConfig.items.map(function(e,t){var a=Object.assign({},e);return a.id=a.id||t,a})),c},we=function(e){var t=e.data,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&Array.isArray(t)?t.map(function(e){return Ee(e,a)}):Ee(t,a)};var Ae,ke,De,Ne,Ce,Se=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e},n={length:0,sum:null,max:null,min:null};return e.reduce(function(e,r){var c=ye()(r,t),o=a(r);return("iso"===t?r.country:r.province)?(r.score&&(n.length++,n.sum+=r.score,n.min?r.score<n.min&&(n.min=r.score):n.min=r.score,n.max?r.score>n.max&&(n.max=r.score):n.max=r.score),e[c]?e[c].push(o):e[c]=[o],e):e},{_stats:n})},Me=new(function(){function e(){Object(T.a)(this,e),this.client=ae.a.create({baseURL:"https://staging-api.globalforestwatch.org/v1",headers:{"Content-Type":"application/json"}})}return Object(_.a)(e,[{key:"fetchLayersFromDataset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.client.get("/dataset/".concat(e,"/layer"),{params:t}).then(function(e){var t=e.status,a=e.statusText,n=e.data;if(t>=400)throw new Error(a);return we(n)})}},{key:"fetchDatasetsLayers",value:function(e){var t=this,a=Object.entries(e).reduce(function(e,a){return[[].concat(Object(ge.a)(e[0]),[a[0]]),[].concat(Object(ge.a)(e[1]),[t.fetchLayersFromDataset(a[1])])]},[[],[]]),n=Object(ve.a)(a,2),r=n[0],c=n[1];return ae.a.all(c).then(function(e){return r.reduce(function(t,a,n){return Object(C.a)({},t,Object(N.a)({},a,e[n]))},{})})}},{key:"fetchDatasetWidgets",value:function(e){var t=this,a=ye()(e,"widget.id",null),n=ye()(e,"widget.params",null),r=ye()(e,"params",{});if(a&&n)return this.client("/widget/".concat(a),r).then(function(e){var t=e.status,a=e.statusText,n=e.data;if(t>=400)throw new Error(a);return we(n)}).then(function(e){var a=t.processWidgetData(e,n);return ae.a.get(a)}).then(function(t){var a=t.status,n=t.statusText,r=t.data;if(a>=400)throw new Error(n);return Se(r.rows,e.indexKey,function(t){return{country:"iso"===e.indexKey?t.country:t.province,category:t.weight,score:t.score,rank:t.score_ranked}})});throw new Error(U.MISSING_WIDGET_REQUEST_PARAMETERS)}},{key:"processWidgetData",value:function(e,t){var a=e.widgetConfig,n=a.data;return a.params_config.reduce(function(e,a){var n=a.key;if(a.required&&!t[n])throw new Error(U.MISSING_REQUIRED_PARAMETER);return e.replace("{{".concat(n,"}}"),"'".concat(t[n],"'"))},n[0].url)}}]),e}()),Le=Object(I.createAction)("DATA/setCountriesData"),Ie=Object(I.createThunkAction)("DATA/loadDashboardData",function(){return function(e,t){var a=t().router.query||{},n=a.country,r=a.indicator;e(Re()),r&&e(Q({data:r})),e(Te()).then(function(t){var a=Object.entries(t).filter(function(e){return"_stats"!==e[0]}).map(function(e){return V(e[0],e[1])});n?e(We({data:n.toUpperCase()})):(e(K({data:t._stats})),e(X({data:a})))})}}),Re=Object(I.createThunkAction)("DATA/getIndicators",function(){return function(e){e(q({data:W})),e(Q({data:W[0].value}))}}),Te=Object(I.createThunkAction)("DATA/getCountriesData",function(){return function(){var e=Object(he.a)(be.a.mark(function e(t,a){var n,r,c;return be.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a().dashboard,r=n.indicators.value){e.next=4;break}return e.abrupt("return");case 4:return c={widget:{id:"e6e5d286-212b-48d8-b5f4-1678cded82bc",params:{indicator:r}},indexKey:"iso"},e.next=7,Me.fetchDatasetWidgets(c).then(function(e){var a=Object.entries(e).filter(function(e){return"_stats"!==e[0]}).map(function(e){return{label:e[1][0].country,value:e[0]}}).sort(function(e,t){return e.label&&t.label?e.label.localeCompare(t.label):-1});return t(Y({data:a})),t(Le({data:e})),e});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}()}),_e=Object(I.createThunkAction)("DATA/getProvincesData",function(){return function(){var e=Object(he.a)(be.a.mark(function e(t,a){var n,r,c,o;return be.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a().dashboard,r=n.locationId,c=n.indicators.value){e.next=4;break}return e.abrupt("return");case 4:return o={widget:{id:"4b3d6e89-869c-45b6-88e3-28735d2b60fe",params:{indicator:c,iso:r}},indexKey:"province"},e.next=7,Me.fetchDatasetWidgets(o);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}()}),xe={getIndicators:Re,getCountriesData:Te,getProvincesData:_e},Pe=Object(I.createAction)("APP/setDashboardCollapsed"),Be=Object(I.createAction)("APP/setModalState"),We=Object(I.createThunkAction)("APP/setCountry",function(e){return function(t){t(J(e)),t(H(e)),t(Ue({params:{country:e.data}})),t(pe(e.data));var a=e.data?_e:Te;t(a()).then(function(e){var a=Object.entries(e).filter(function(e){return"_stats"!==e[0]}).map(function(e){return V(e[0],e[1])});t(K({data:e._stats})),t(X({data:a}))}),e.data||t(re({bbox:[-180,90,180,-90]}))}}),Fe=Object(I.createThunkAction)("APP/setIndicator",function(e){return function(t,a){t(Q(e)),t(Ue({params:{indicator:e.data}}));var n=a().dashboard.scope;t((n===ee.COUNTRY?_e:Te)()).then(function(e){var a=Object.entries(e).filter(function(e){return"_stats"!==e[0]}).map(function(e){return V(e[0],e[1])});t(K({data:e._stats})),t(X({data:a}))})}}),Ue=Object(I.createThunkAction)("APP/saveData",function(e){var t=e.params,a=e.replace;return function(e,n){var r=n().router,c=r.type,o=r.query,i=a?Object(C.a)({},t):Object(C.a)({},o,t);e({type:c,query:Object.fromEntries(Object.entries(i).filter(function(e){return Boolean(e[1])}))})}}),Ge=Object(I.createThunkAction)("APP/saveData",function(){return function(){B.saveRankings()}}),ze=(Ae={},Object(N.a)(Ae,We,function(e,t){var a=t.payload;return Object(C.a)({},e,{country:a.value})}),Object(N.a)(Ae,Pe,function(e,t){var a=t.payload;return Object(C.a)({},e,{isDashboardCollapsed:Boolean(a)})}),Object(N.a)(Ae,Be,function(e,t){var a=t.payload;return Object(C.a)({},e,{isModalOpen:Boolean(a)})}),Ae),Ve={isDashboardCollapsed:!1,isModalOpen:!1},Ye=(ke={},Object(N.a)(ke,Le,function(e,t){var a=t.payload.data;return Object(C.a)({},e,{countries:Object(C.a)({},e.countries,{data:a})})}),Object(N.a)(ke,"DATA/getCountries_STARTED",function(e){return Object(C.a)({},e,{countries:Object(C.a)({},e.countries,{isLoading:!0})})}),Object(N.a)(ke,"DATA/getCountries_SUCCEEDED",function(e){return Object(C.a)({},e,{countries:Object(C.a)({},e.countries,{isLoading:!1,isLoaded:!0})})}),Object(N.a)(ke,"DATA/getIndicators_STARTED",function(e){return Object(C.a)({},e,{indicators:Object(C.a)({},e.indicators,{isLoading:!0})})}),Object(N.a)(ke,"DATA/getIndicators_SUCCEEDED",function(e){return Object(C.a)({},e,{indicators:Object(C.a)({},e.indicators,{isLoading:!1,isLoaded:!0})})}),Object(N.a)(ke,"DATA/getWidgetData_STARTED",function(e){return Object(C.a)({},e,{widget:Object(C.a)({},e.widget,{isLoading:!0})})}),Object(N.a)(ke,"DATA/getWidgetData_SUCCEEDED",function(e){return Object(C.a)({},e,{widget:Object(C.a)({},e.widget,{isLoading:!1,isLoaded:!0})})}),ke),qe={countries:{data:null,isLoading:!1,isLoaded:!1,error:null},provinces:{cache:[],data:null,isLoading:!1,isLoaded:!1,error:null},indicators:{data:null,isLoading:!1,isLoaded:!1,error:null}},Je=a(40),He=[{name:"HOME",path:"/:iso?/:indicator?",page:"home"},{name:Je.NOT_FOUND,path:"/404",page:"not-found"}],Qe=He.reduce(function(e,t){return Object(C.a)({},e,Object(N.a)({},t.name,Object(I.createAction)("PAGES/".concat(t.name))))},{}),Xe=Object(I.createAction)("PAGES/setPage"),Ke=Object.keys(Qe).reduce(function(e,t){return Object(C.a)({},e,Object(N.a)({},t,function(e){return function(t,a){var n=a.payload;return Object(C.a)({},t,{current:e,payload:n})}}(t)))},{}),Ze={current:"PAGES/HOME"},$e=(De={},Object(N.a)(De,ne,function(e,t){var a=t.payload;return Object(C.a)({},e,a)}),Object(N.a)(De,re,function(e,t){var a=t.payload;return Object(C.a)({},e,{bounds:a})}),Object(N.a)(De,se,function(e,t){var a=t.payload;return Object(C.a)({},e,{basemap:a})}),Object(N.a)(De,ce,function(e,t){var a=t.payload;return Object(C.a)({},e,{mapStyle:a})}),Object(N.a)(De,oe,function(e,t){var a=t.payload;return Object(C.a)({},e,{mapLabels:a})}),Object(N.a)(De,ie,function(e,t){var a=t.payload;return Object(C.a)({},e,{mapRoads:a})}),Object(N.a)(De,ue,function(e,t){var a=t.payload;return Object(C.a)({},e,{viewport:a})}),Object(N.a)(De,le,function(e,t){var a=t.payload;return Object(C.a)({},e,{settings:{isLoaded:a}})}),Object(N.a)(De,de,function(e,t){var a=t.payload;return Object(C.a)({},e,{settings:{isFlying:a}})}),De),et={viewport:{zoom:2,latitude:41.145218001222204,longitude:-8.61132408966133},basemap:"hydro"},tt=Object(I.createAction)("LAYERS/setList"),at=Object(I.createAction)("LAYERS/setLoading"),nt=Object(I.createAction)("LAYERS/setError"),rt=Object(I.createAction)("LAYERS/setLayersOpacity"),ct=Object(I.createThunkAction)("LAYERS/getLayers",function(){return function(e){e(at(!0)),e(nt(null));return Me.fetchDatasetsLayers({country_rankings:"fd4b4ba5-a16a-45a4-bc6b-954397e37bda",province_rankings:"e0adfbfb-441d-4ec5-9e4c-7d051d0f7b22"}).then(function(t){e(tt(t)),e(at(!1))}).catch(function(t){e(nt(t)),e(at(!1))})}}),ot={setList:tt,setLoading:at,setError:nt,getLayers:ct,setLayersOpacity:rt},it=(Ne={},Object(N.a)(Ne,tt,function(e,t){var a=t.payload;return Object(C.a)({},e,{list:a})}),Object(N.a)(Ne,at,function(e,t){var a=t.payload;return Object(C.a)({},e,{isLoading:Boolean(a)})}),Object(N.a)(Ne,nt,function(e,t){var a=t.payload;return Object(C.a)({},e,{error:a})}),Object(N.a)(Ne,rt,function(e,t){var a=t.payload;return Object(C.a)({},e,{list:{country_rankings:e.list.country_rankings.map(function(e){return Object(C.a)({},e,{opacity:a})}),province_rankings:e.list.province_rankings.map(function(e){return Object(C.a)({},e,{opacity:a})})}})}),Ne),st={list:null,isLoading:!1,isLoaded:!1,error:null},ut=(Ce={},Object(N.a)(Ce,Y,function(e,t){var a=t.payload.data;return Object(C.a)({},e,{countries:Object(C.a)({},e.countries,{list:a})})}),Object(N.a)(Ce,q,function(e,t){var a=t.payload.data;return Object(C.a)({},e,{indicators:Object(C.a)({},e.indicators,{list:a})})}),Object(N.a)(Ce,J,function(e,t){var a=t.payload.data;return Object(C.a)({},e,{locationId:a,scope:a?ee.COUNTRY:ee.GENERAL})}),Object(N.a)(Ce,H,function(e,t){var a=t.payload.data;return Object(C.a)({},e,{countries:Object(C.a)({},e.countries,{value:a})})}),Object(N.a)(Ce,Q,function(e,t){var a=t.payload.data;return Object(C.a)({},e,{indicators:Object(C.a)({},e.indicators,{value:a})})}),Object(N.a)(Ce,X,function(e,t){var a=t.payload.data;return Object(C.a)({},e,{widget:Object(C.a)({},e.widget,{data:a})})}),Object(N.a)(Ce,K,function(e,t){var a=t.payload.data;return Object(C.a)({},e,{widget:Object(C.a)({},e.widget,{stats:a})})}),Object(N.a)(Ce,Z,function(e,t){var a=t.payload.data;return Object(C.a)({},e,{width:a})}),Ce),lt={scope:ee.GENERAL,locationId:null,width:null,countries:{list:[],value:null},indicators:{list:[],value:null},widget:{data:[]}},dt=a(236),pt=a.n(dt),mt=He.reduce(function(e,t){return Object(C.a)({},e,Object(N.a)({},t.name,Object(C.a)({path:t.path},{thunk:t.thunk})))},{}),ft={basename:"/",location:"router",notFoundPath:"".concat("/","404"),initialDispatch:!1,querySerializer:pt.a},bt=Object(Je.connectRoutes)(mt,ft),ht=[{namespace:"app",components:s},{namespace:"data",components:l},{namespace:"page",components:m},{namespace:"map",components:b},{namespace:"layers",components:v},{namespace:"dashboard",components:y}],gt=bt.initialDispatch,vt=bt.reducer,Ot=bt.middleware,yt=bt.enhancer,jt=Object(S.combineReducers)(Object(C.a)({router:vt},ht.reduce(function(e,t){return Object(C.a)({},e,Object(N.a)({},t.namespace,Object(I.handleModule)(t.components)))},{}))),Et=Object(S.applyMiddleware)(Ot,M.a),wt=Object(L.composeWithDevTools)(yt,Et),At=Object(S.createStore)(jt,wt);gt();var kt=At,Dt=Object(k.b)(function(e){return{}},{})(D.Modal),Nt=a(55),Ct=a(53),St=a(54),Mt=a(237),Lt=a.n(Mt),It=a(18),Rt=function(e){function t(e){var a;return Object(T.a)(this,t),(a=Object(Nt.a)(this,Object(Ct.a)(t).call(this,e))).state={copied:!1},a}return Object(St.a)(t,e),Object(_.a)(t,[{key:"componentWillMount",value:function(){this.props.getShareUrl(window.location.href)}},{key:"componentDidMount",value:function(){var e=this;this.clipboard=new Lt.a(this.btn),this.clipboard.on("success",function(t){e.setState({copied:!0}),setTimeout(function(){e.setState({copied:!1}),t.clearSelection()},2e3)}),this.clipboard.on("error",function(){e.setState({error:!0}),setTimeout(function(){e.setState({error:!1})},2e3)})}},{key:"triggerPopup",value:function(e){e&&e.preventDefault();var t=(window.innerWidth-575)/2,a=(window.innerHeight-400)/2,n=e.currentTarget.href,r="status=1,width=".concat(575,",height=").concat(400,",top=").concat(a,",left=").concat(t);window.open(n,"Share this analysis",r)}},{key:"render",value:function(){var e=this,t="Water and Food Security Analyzer",a=this.props.share.url||window.location.href,n=encodeURIComponent(this.props.share.url||window.location.href),r="Copy",c="";return this.state.copied&&(r="Copied",c="-success"),this.state.error&&(r="Error",c="-error"),E.a.createElement("div",{className:"c-share"},E.a.createElement("div",{className:"share-header"},E.a.createElement("h3",{className:"share-title"},"Share this page")),E.a.createElement("div",{className:"share-content"},E.a.createElement("div",{className:"share-button"},E.a.createElement("input",{id:"url",className:"share-url",value:a,readOnly:!0,onFocus:function(e){return e.currentTarget.select()}}),E.a.createElement("button",{"data-clipboard-target":"#url",ref:function(t){e.btn=t},className:"c-btn -primary ".concat(c),type:"button"},r)),E.a.createElement("div",{className:"share-sozial"},E.a.createElement("a",{href:"https://twitter.com/share?url=".concat(n),target:"_blank",rel:"noopener noreferrer",className:"c-btn -primary -with-icon -twitter -social",onClick:this.triggerPopup},E.a.createElement(It.Icon,{name:"icon-twitter"}),E.a.createElement("span",null,"Twitter")),E.a.createElement("a",{href:"https://www.facebook.com/sharer/sharer.php?u=".concat(n,"&t=").concat(t),target:"_blank",rel:"noopener noreferrer",className:"c-btn -primary -with-icon -facebook -social",onClick:this.triggerPopup},E.a.createElement(It.Icon,{name:"icon-facebook"}),E.a.createElement("span",null,"Facebook")),E.a.createElement("a",{href:"https://www.linkedin.com/shareArticle?mini=true&url=".concat(n,"&title=").concat(t,"&summary=&source="),target:"_blank",rel:"noopener noreferrer",className:"c-btn -primary -with-icon -linkedin -social",onClick:this.triggerPopup},E.a.createElement(It.Icon,{name:"icon-linkedin"}),E.a.createElement("span",null,"Linkedin")))))}}]),t}(E.a.Component);Rt.defaultProps={share:{},getShareUrl:function(e){return e}};var Tt=a(74),_t=Object(Tt.a)([function(e){return e.data}],function(e){return e.countries.data}),xt=Object(Tt.a)([function(e){return e.dashboard}],function(e){return e.locationId}),Pt=Object(Tt.a)([xt,_t],function(e,t){return e?V(e,t[e]):null}),Bt={container:function(e){return Object(C.a)({},e,{height:"40px"})},valueContainer:function(e){return Object(C.a)({},e,{height:"40px",marginLeft:"16px"})}},Wt=function(){return E.a.createElement("div",{className:"country-selector--icon"},E.a.createElement(It.Icon,{className:"-small",name:"icon-search"}))};function Ft(e){var t=e.countries,a=e.setCountry;return E.a.createElement(D.CustomSelect,{theme:"light",placeholder:"Search a country",options:t.list,onChange:function(e){a({data:e.value})},customClass:"c-country-selector",styles:Bt,components:{IndicatorsContainer:Wt},value:t.value})}Ft.defaultProps={setCountry:function(){console.log("Country value was changed.")}};var Ut=Ft,Gt={setCountry:We},zt=Object(k.b)(function(e){return{countries:e.dashboard.countries}},Gt)(Ut),Vt=a(119),Yt=a.n(Vt);function qt(e){var t=e.indicators,a=e.setIndicator,n=e.className;return E.a.createElement(D.Field,{name:"indication-filter",label:"Select Water Risk Indicator",className:"-bigger"},E.a.createElement(D.CustomSelect,{theme:"light",options:t.list,onChange:function(e){return a({data:e.value})},customClass:Yt()("c-indicator-selector",Object(N.a)({},n,Boolean(n))),value:t.value}))}qt.defaultProps={setIndicator:function(){console.log("Indicator value was changed.")}};var Jt=qt,Ht={setIndicator:Fe},Qt=Object(k.b)(function(e){return{indicators:e.dashboard.indicators}},Ht)(Jt),Xt=function(){return E.a.createElement("header",{className:"c-header"},E.a.createElement("div",{className:"header--content"},E.a.createElement(zt,null),E.a.createElement(Qt,null),E.a.createElement("p",{className:"header--disclaimer"},"This map is for illustrative purposes and does not imply the expression of any opinion on the part of WRI concerning the legal status of any country or territory, or concerning the delimitation of frontiers or boundaries.")))},Kt=function(e){var t=e.onBackClick,a=e.data,n=["Irr","Dom","Ind","Tot"],r=Object.fromEntries(Object.entries(a.indicators).filter(function(e){return n.includes(e[0])}).sort(function(e,t){return n.indexOf(e[0])-n.indexOf(t[0])}));return E.a.createElement("header",{className:"c-header"},E.a.createElement("div",{className:"header--back-button",onClick:function(){return t()}},E.a.createElement(It.Icon,{className:"-small",name:"icon-arrow-left"}),E.a.createElement("span",{className:"-uppercase"},"Country Rankings")),E.a.createElement("div",{className:"header--content"},E.a.createElement("div",{className:"header--info"},E.a.createElement("h1",null,a.name),E.a.createElement(D.Field,{name:"header-indicators",label:"Summary Results",className:"-bigger"},E.a.createElement("ul",{className:"header--indicators"},Object.entries(r).map(function(e){return E.a.createElement("li",{className:"header--indicator",key:e[0]},e[1].name,": ",e[1].score)})))),E.a.createElement(Qt,{className:"header--indicator-selector"}),E.a.createElement("p",{className:"header--disclaimer"},"This map is for illustrative purposes and does not imply the expression of any opinion on the part of WRI concerning the legal status of any country or territory, or concerning the delimitation of frontiers or boundaries.")))};Kt.defaultProps={onBackClick:function(){console.log("Go back button was pressed.")}};var Zt=Kt,$t=function(e){var t=e.className,a=e.height,n=e.width,r=e.fill;return E.a.createElement("div",{className:t,style:{display:"inline-block",backgroundColor:r,height:a,width:n}})};$t.defaultProps={height:"11px",width:"11px",fill:"#000000"};var ea=$t,ta=function(e){var t=e.indicators,a=e.config,n=a.fields,r=a.palette,c=a.length;if(!t)return null;var o=function(e,t){return e[t%e.length]};return E.a.createElement(j.Fragment,null,n.map(function(e,a){if(!t[e])return null;var n=t[e].score;return E.a.createElement("div",{key:e},E.a.createElement("span",{className:"widget--chart-text"},"".concat(n)),E.a.createElement(ea,{fill:o(r,a),width:"".concat(c(n),"px")}))}))},aa=function(e){var t=e.classes,a=e.rowNumber,n=e.country,r=e.chartConfig;return E.a.createElement("div",{className:Yt()("c-widget",Object(N.a)({},t.row,Boolean(t.row)))},E.a.createElement("div",{className:t.columns[0]},a),E.a.createElement("div",{className:t.columns[1]},n.name),E.a.createElement("div",{className:t.columns[2]},E.a.createElement(ta,{indicators:n.indicators,config:r})),E.a.createElement("div",{className:t.columns[3]},n.indicators&&n.indicators.Tot&&n.indicators.Tot.score))},na=["#3FA989","#00A0E1","#4A596A"],ra=["Irr","Dom","Ind","Pop"],ca={row:"widgets--content-row",columns:["widgets--row-number","widgets--name","widgets--chart","widgets--total"]},oa=function(e){var t=e.title,a=e.buttonText,n=e.data,r=e.onSelect;if(0===n.length)return null;var c=Object.entries(n[0].indicators).filter(function(e){return ra.includes(e[0])}).sort(function(e,t){return ra.indexOf(e[0])-ra.indexOf(t[0])}).map(function(e,t){return E.a.createElement("div",{className:"widgets--content-legend",key:e},E.a.createElement(ea,{className:"widgets--content-bullet",fill:na[t]}),e[1].name)}),o={fields:ra,palette:na,length:function(e){return e/5*76}},i=n.sort(function(e,t){var a=e.indicators,n=a.Tot,r=a.Pop,c=t.indicators,o=c.Tot,i=c.Pop;return n&&o&&n.score&&o.score?parseFloat(o.score)-parseFloat(n.score):r&&i&&r.score&&i.score?parseFloat(i.score)-parseFloat(r.score):0});return E.a.createElement("div",{className:"c-widgets"},E.a.createElement("div",{className:"widgets--header"},E.a.createElement("span",{className:"-uppercase"},t),E.a.createElement("button",{type:"button",onClick:r},a)),E.a.createElement("div",{className:"widgets--content-wrapper"},E.a.createElement("div",{className:"widgets--content-header"},E.a.createElement("div",{className:ca.columns[0]},"Rank"),E.a.createElement("div",{className:ca.columns[1]},"Name"),E.a.createElement("div",{className:ca.columns[2]},"Sectoral Score",c),E.a.createElement("div",{className:ca.columns[3]},"Total Score")),E.a.createElement("div",{className:"widgets--content-body"},i.map(function(e,t){return E.a.createElement(aa,{classes:ca,key:e.iso,rowNumber:t+1,country:e,chartConfig:o})}))))};oa.defaultProps={title:"Water Usage (Score)",buttonText:"Download ranking"};var ia=oa,sa=function(e){return e.scope===ee.GENERAL?null:E.a.createElement("footer",{className:"c-footer"},E.a.createElement(D.Field,{name:"countries-filter",label:"Explore more",className:"-bigger"},E.a.createElement(zt,null)))},ua=function(e){var t=e.width,a=e.setWidth,n=e.scope,r=e.headerData,c=e.widgetsData,o=e.setCountry,i=e.saveData,s=Object(j.useRef)(null);Object(j.useEffect)(function(){var e=s.current.offsetWidth;e!==t&&a({data:e})});var u=n===ee.GENERAL?"Country Rankings":"Sub-national Rankings";return E.a.createElement("div",{ref:s,className:"dashboard"},n===ee.GENERAL?E.a.createElement(Xt,null):E.a.createElement(Zt,{data:r,onBackClick:function(){return o({data:null})}}),E.a.createElement(ia,{data:c,onSelect:i,title:u}),E.a.createElement(sa,{scope:n}))},la={setCountry:We,saveData:Ge,setWidth:Z},da=Object(k.b)(function(e){return{scope:e.dashboard.scope,width:e.dashboard.width,headerData:Pt(e),widgetsData:e.dashboard.widget.data}},la)(ua),pa=function(e){function t(){return Object(T.a)(this,t),Object(Nt.a)(this,Object(Ct.a)(t).apply(this,arguments))}return Object(St.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){var e=this.props.activeLayer.legendConfig;return e&&"choropleth"===e.type?E.a.createElement("div",null,E.a.createElement("ul",{className:"c-legend-type-choropleth"},e.items.map(function(e){var t=e.name,a=e.value,n=e.color;return E.a.createElement("li",{key:"legend-choropleth-item-".concat(t||a)},E.a.createElement("div",{className:"icon-choropleth",style:{backgroundColor:n}}),E.a.createElement("span",{className:"name"},t),E.a.createElement("span",{className:"name"},a))})),e.disclaimer&&E.a.createElement("div",{className:"graph -basic -disclaimer"},E.a.createElement("div",{className:"graph-list"},e.disclaimer.map(function(e){return E.a.createElement("div",{className:"graph-list-item",key:e.name},E.a.createElement("span",{className:"color",style:{background:e.color}}),E.a.createElement("span",{className:"label"},e.name))})))):null}}]),t}(E.a.PureComponent);pa.defaultProps={activeLayer:{}};var ma=pa,fa=a(117),ba=a(238),ha=a.n(ba),ga={url:"https://api.tiles.mapbox.com/v4/wri.acf5a04e/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoid3JpIiwiYSI6IjU3NWNiNGI4Njc4ODk4MmIyODFkYmJmM2NhNDgxMWJjIn0.v1tciCeBElMdpnrikGDrPg",options:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank" rel="noopener noreferrer">OpenStreetMap</a>'}},va={osm:{id:"osm",value:"https://api.tiles.mapbox.com/v4/wri.c974eefc/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoid3JpIiwiYSI6IjU3NWNiNGI4Njc4ODk4MmIyODFkYmJmM2NhNDgxMWJjIn0.v1tciCeBElMdpnrikGDrPg",label:"Light",options:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank" rel="noopener noreferrer">OpenStreetMap</a>'}},satellite:{id:"satellite",value:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",label:"Satellite",options:{attribution:'&copy; <a href="https://www.google.com/maps/@15,-2.970703,3z?hl=es" target="_blank">Google</a>'}},terrain:{id:"terrain",value:"https://api.mapbox.com/styles/v1/resourcewatch/cjhqi456h02pg2rp6w2mwp61c/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicmVzb3VyY2V3YXRjaCIsImEiOiJjajFlcXZhNzcwMDBqMzNzMTQ0bDN6Y3U4In0.FRcIP_yusVaAy0mwAX1B8w",label:"Terrain",options:{attribution:'<a href="https://www.mapbox.com/about/maps/" target="_blank">\xa9 Mapbox</a> <a href="http://www.openstreetmap.org/about/" target="_blank">\xa9 OpenStreetMap</a>'}},hydro:{id:"hydro",value:"https://api.mapbox.com/styles/v1/resourcewatch/cjtr6fhr3060g1fok829tfwm7/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoicmVzb3VyY2V3YXRjaCIsImEiOiJjajFlcXZhNzcwMDBqMzNzMTQ0bDN6Y3U4In0.FRcIP_yusVaAy0mwAX1B8w",label:"Hydrography",options:{attribution:'<a href="https://www.mapbox.com/about/maps/" target="_blank">\xa9 Mapbox</a> <a href="http://www.openstreetmap.org/about/" target="_blank">\xa9 OpenStreetMap</a>'}}},Oa=function(e){function t(e){var a;return Object(T.a)(this,t),(a=Object(Nt.a)(this,Object(Ct.a)(t).call(this,e))).state={active:!1},a._onScreenClick=a.onScreenClick.bind(Object(fa.a)(a)),a}return Object(St.a)(t,e),Object(_.a)(t,[{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.onScreenClick)}},{key:"onScreenClick",value:function(e){var t=document.querySelector(".c-basemap-tooltip");t&&t.contains&&!t.contains(e.target)&&this.toggleDropdown(!1)}},{key:"onBasemapChange",value:function(e){var t=e.value;this.props.setBasemap(t)}},{key:"toggleDropdown",value:function(e){var t=this,a="undefined"!==typeof e&&null!==e?e:!this.state.active;this.setState({active:a}),requestAnimationFrame(function(){e?window.addEventListener("click",t._onScreenClick):window.removeEventListener("click",t._onScreenClick)}),this.setState({active:a})}},{key:"render",value:function(){var e=this,t=this.props.basemap,a=this.state.active;return E.a.createElement(ha.a,{attachment:"top right",constraints:[{to:"window"}],targetOffset:"8px 100%",classes:{element:"c-basemap-tooltip -arrow-right"}},E.a.createElement("button",{type:"button",className:"basemap-button",onClick:function(){return e.toggleDropdown(!0)}},E.a.createElement(D.Icon,{name:"layers",className:"-small"})),a&&E.a.createElement("div",null,E.a.createElement(D.RadioGroup,{items:Object.keys(va).map(function(e){var t=va[e];return{label:t.label,value:t.id}}),name:"basemap",selected:t,onChange:function(t){e.onBasemapChange(t)}}),E.a.createElement("div",{className:"divisor"})))}}]),t}(j.PureComponent),ya=Object(k.b)(function(e){return{basemap:e.map.basemap}},{setBasemap:se})(Oa),ja=a(239),Ea=a(158),wa=function(e){function t(){var e,a;Object(T.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(Nt.a)(this,(e=Object(Ct.a)(t)).call.apply(e,[this].concat(r)))).state={latlng:null,interactions:{}},a}return Object(St.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.className,n=void 0===a?"":a,r=t.viewport,c=t.layers,o=t.bounds,i=t.basemap,s=t.scope,u=t.setLayersOpacity,l=t.setModalState,d=Object(C.a)({},va[i||"osm"],{url:va[i||"osm"].value}),p={customClass:n,mapOptions:{zoom:r.zoom,center:{lat:r.latitude,lng:r.longitude}},bounds:o,basemap:d,events:{zoomend:function(e,t){},dragend:function(e,t){}}},m=c&&c.length?c.map(function(e){return{name:e.name,dataset:e.dataset,layers:[Object(C.a)({},e,{active:!0})]}}):[];"COUNTRY"!==s&&(p.label=ga);var f=function(){l(!0)};return E.a.createElement(It.Map,p,function(t){return window.m=t,E.a.createElement(j.Fragment,null,E.a.createElement(Ea.LayerManager,{map:t,plugin:ja.a,onReady:function(){}},c.map(function(t){return E.a.createElement(Ea.Layer,Object.assign({key:t.id},t,!!t.interactionConfig&&!!t.interactionConfig.output&&!!t.interactionConfig.output.length&&{interactivity:"carto"!==t.provider&&"cartodb"!==t.provider||t.interactionConfig.output.map(function(e){return e.column}),events:{click:function(t){e.setState({interactionData:t.data,latlng:t.latlng})}}}))})),E.a.createElement(It.MapControls,null,E.a.createElement(It.ZoomControl,{map:t}),E.a.createElement(ya,null),E.a.createElement("button",{type:"button",onClick:f},E.a.createElement(It.Icon,{className:"-medium",name:"icon-share"}))),E.a.createElement(It.MapPopup,{map:t,latlng:e.state.latlng,data:{latlng:e.state.latlng,interactions:e.state.interactions}},e.state.interactionData?E.a.createElement("div",null,e.state.interactionData.name_1?E.a.createElement("div",null,E.a.createElement("h3",null,e.state.interactionData.name_1),E.a.createElement("h4",null,e.state.interactionData.name_0)):E.a.createElement("h3",null,e.state.interactionData.name_0),E.a.createElement("div",null,e.state.interactionData.label)):E.a.createElement("div",null,"No data")),E.a.createElement("div",{className:"c-legend"},E.a.createElement(It.Legend,{sortable:!1},m.map(function(e,t){return E.a.createElement(It.LegendListItem,{index:t,key:e.dataset,layerGroup:e,onChangeOpacity:function(e,t){return u(t)},toolbar:E.a.createElement(It.LegendItemToolbar,null,E.a.createElement(It.LegendItemButtonOpacity,{trackStyle:{backgroundColor:"#2E57B8"},handleStyle:{backgroundColor:"#2E57B8"}}))},E.a.createElement(It.LegendItemTypes,null,E.a.createElement(ma,null)))}))))})}}]),t}(j.Component);wa.defaultProps={children:null,viewport:{zoom:2,lat:0,lng:0},bounds:{},dragPan:!0,dragRotate:!0,onViewportChange:function(){},onLoad:function(){},onStyleLoad:function(){},setMapViewport:function(){},layers:[]};var Aa=wa,ka={bws:0,drr:1,rfr:2},Da=Object(Tt.a)([function(e){return e.layers.list},function(e){return e.dashboard.scope},function(e){return e.dashboard.locationId},function(e){return e.dashboard.indicators.value}],function(e,t,a,n){if(!e)return[];var r=ka[n];if("COUNTRY"===t){var c=e.province_rankings[r];return[Object(C.a)({},c,{opacity:c.opacity||.5,params:Object(C.a)({},c.params,{iso:a})})]}return[Object(C.a)({},e.country_rankings[r],{opacity:e.country_rankings[r].opacity||.5})]}),Na={setMapViewport:ue,setMapBounds:re,setMapLoaded:le,setMapFlying:de,setLayersOpacity:rt,setModalState:Be},Ca=Object(k.b)(function(e){return Object(C.a)({},e.map,{layers:Da(e),scope:e.dashboard.scope})},Na)(Aa),Sa=function(e){var t=e.isDashboardCollapsed,a=e.isModalOpen,n=e.setDashboardCollapsed,r=e.setModalState;return E.a.createElement("main",{className:"c-main"},E.a.createElement(D.Sidebar,{customClass:"c-aqueduct-sidebar",onToggle:function(e){n(!e)},visible:!t},E.a.createElement(da,null)),E.a.createElement("div",{className:"map-wrapper"},E.a.createElement(Ca,{className:"c-aqueduct-map"})),E.a.createElement(Dt,{isOpen:a,appElement:"#root",onRequestClose:function(){return r(!1)}},E.a.createElement(Rt,null)))},Ma={setDashboardCollapsed:Pe,getLayers:ct,setModalState:Be},La=Object(k.b)(function(e){return Object(C.a)({},e.app)},Ma)(Sa),Ia=function(e){var t=e.getLayers,a=e.loadDashboardData;return Object(j.useEffect)(function(){t(),a()},[t,a]),E.a.createElement(La,null)},Ra=function(){return E.a.createElement("div",null,E.a.createElement("h1",null,"Not found"))},Ta=new Map([["HOME",Ia],["LOCATION",Ia]]),_a=function(e){var t=e.page.current,a=Ta.has(t)?Ta.get(t):Ra;return E.a.createElement(a,e)},xa={getLayers:ct,loadDashboardData:Ie},Pa=Object(k.b)(function(e){return{page:e.page}},xa)(_a);a(415),a(627);A.a.render(E.a.createElement(function(){return E.a.createElement(k.a,{store:kt},E.a.createElement(D.Icons,null),E.a.createElement(Pa,null))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[242,1,2]]]);
//# sourceMappingURL=main.b61c9228.chunk.js.map